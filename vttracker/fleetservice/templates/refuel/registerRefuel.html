{% extends 'base.html' %}

{% block head %}
<title>VTtracker Registrar Recarca Combustible</title>
<style>
  .content-binnacle{
    width: 350px;
  }
</style>
{% endblock %}
{% block body %}
<div class="container">
  <div class="content-binnacle">
    <h5>Recarga de Combustible</h5>
    <br>
    <form class="formRefuel" method="post" id="formSaveRefuel" action="{% url 'registerRefuel'  %}">
      {% csrf_token %}
      <div class="form-group">
        {{form.liters.label_tag}}
        {{form.liters}}
      </div>
      <div class="form-group">
        {{form.amount.label_tag}}
        {{form.amount}}
      </div>
      <div class="form-group">
        {{form.datetime.label_tag}}
        {{form.datetime}}
      </div>
      <div class="form-group">
        {{form.image.label_tag}}
        {{form.image}}
      </div>
      <br>
      <div class="btnSaveRefuel">
        <button class="btn btn-info" type="submit" id="btnSaveRefuel">Guardar</button>
      </div>
    </form>
  </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>

  $('#datepickerA').attr('type', 'date');

  var $j = jQuery.noConflict();

  function jsonFormat(formArray) {
    let returnArray = {};
    for (let i=0;i<formArray.length;i++) {
        if (formArray[i].value) {
            returnArray[formArray[i].name] = formArray[i].value;
        }
    }
    return returnArray;
  }

  function saveRefuel(formData){
    let form = $j('#formSaveRefuel');

    $j.ajax({
      type: form.attr('method'),
      url: form.attr('action'),
      data: formData,
      success: function(response){
        console.log(response);
        if(response.status){
          alert(response.msg);
        }
      },
      error: function(e){
        console.log(e);
      }
    });
  }

  $j('#btnSaveRefuel').click(function(e){
    e.preventDefault();

    //validation
    let form = $j('#formSaveRefuel');
    let formData = jsonFormat(form.serializeArray());
    console.log(formData);

    saveRefuel(formData);
  });

</script>
{% endblock %}
